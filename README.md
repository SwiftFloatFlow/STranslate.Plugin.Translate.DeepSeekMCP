# DeepSeekMCP ç¿»è¯‘æ’ä»¶ - STranslate Plugin

## é¡¹ç›®æ¦‚è¿°

**DeepSeekMCP** æ˜¯ä¸€ä¸ªä¸“ä¸º **STranslate** æ‰“é€ çš„ç¿»è¯‘æ’ä»¶ï¼Œæ”¯æŒ MCPï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨å·¥å…·è°ƒç”¨ã€‚è¯¥æ’ä»¶åœ¨æ ‡å‡† DeepSeek ç¿»è¯‘åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œå…è®¸ AI åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­æ™ºèƒ½è°ƒç”¨å¤–éƒ¨ MCP æœåŠ¡å™¨å·¥å…·ï¼ˆå¦‚ç½‘ç»œæœç´¢ã€æ•°æ®æŸ¥è¯¢ã€ä»£ç æ‰§è¡Œç­‰ï¼‰ï¼Œå®ç°æ›´ç²¾å‡†ã€æ›´ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç¿»è¯‘ä½“éªŒã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **DeepSeek API ç¿»è¯‘**ï¼šé›†æˆ DeepSeek AI è¿›è¡Œé«˜è´¨é‡ç¿»è¯‘ï¼Œæ”¯æŒå¤šç§æ¨¡å‹é€‰æ‹©
- **MCP å·¥å…·é›†æˆ**ï¼šæ”¯æŒè¿æ¥ MCP æœåŠ¡å™¨ï¼Œåœ¨ç¿»è¯‘ä¸­è°ƒç”¨å¤–éƒ¨å·¥å…·
- **å¤šç­–ç•¥æ”¯æŒ**ï¼šæä¾› 5 ç§å·¥å…·è°ƒç”¨ç­–ç•¥ï¼ˆç¦ç”¨/ç©ºç™½/æ··åˆ/ä¼˜å…ˆ/å¼ºåˆ¶ï¼‰
- **å¤šæœåŠ¡å™¨ç®¡ç†**ï¼šæ”¯æŒé…ç½®å¤šä¸ª MCP æœåŠ¡å™¨ï¼ŒåŠ¨æ€å‘ç°å’Œç®¡ç†å·¥å…·
- **å¯è§†åŒ–é…ç½®**ï¼šå®Œæ•´çš„è®¾ç½®ç•Œé¢ï¼Œæ”¯æŒæœåŠ¡å™¨ç®¡ç†ã€å·¥å…·å¼€å…³ã€æµ‹è¯•è¿æ¥

## æŠ€æœ¯æ ˆ

- **.NET 8.0** - è¿è¡Œæ—¶
- **WPF** - ç”¨æˆ·ç•Œé¢
- **CommunityToolkit.Mvvm** - MVVM æ¡†æ¶
- **iNKORE.UI.WPF.Modern** - ç°ä»£ UI ç»„ä»¶
- **Newtonsoft.Json** - JSON åºåˆ—åŒ–
- **MCP Protocol** - æ¨¡å‹ä¸Šä¸‹æ–‡åè®®

## MCP å·¥å…·è°ƒç”¨èƒ½åŠ›

DeepSeekMCP çš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯æ”¯æŒ AI åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­**åŠ¨æ€è°ƒç”¨å¤–éƒ¨ MCP æœåŠ¡å™¨å·¥å…·**ï¼Œæ˜¾è‘—æå‡å›å¤è´¨é‡ï¼š

### æ”¯æŒçš„å·¥å…·ç±»å‹

- **æœç´¢ç±»**ï¼šç½‘ç»œæœç´¢ã€çŸ¥è¯†åº“æŸ¥è¯¢ã€ä»£ç åº“æ£€ç´¢
- **æ•°æ®å¤„ç†**ï¼šæ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶è¯»å–ã€æ ¼å¼è½¬æ¢
- **è®¡ç®—æ‰§è¡Œ**ï¼šä»£ç æ‰§è¡Œã€æ•°å­¦è®¡ç®—ã€é€»è¾‘å¤„ç†
- **å¤–éƒ¨æœåŠ¡**ï¼šAPI è°ƒç”¨ã€è®¤è¯æœåŠ¡ã€ä¸šåŠ¡ç³»ç»Ÿé›†æˆ

### å…¸å‹åº”ç”¨åœºæ™¯

1. **æŠ€æœ¯æ–‡æ¡£ç¿»è¯‘**ï¼šAI è‡ªåŠ¨æŸ¥è¯¢æœ¯è¯­å®šä¹‰ã€API æ–‡æ¡£ï¼Œç¡®ä¿ä¸“ä¸šæœ¯è¯­å‡†ç¡®
2. **å®æ—¶ä¿¡æ¯ç¿»è¯‘**ï¼šè°ƒç”¨æœç´¢å¼•æ“è·å–æœ€æ–°èƒŒæ™¯ä¿¡æ¯ï¼Œæä¾›ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç¿»è¯‘
3. **å¤šè¯­è¨€æœ¯è¯­ç»Ÿä¸€**ï¼šè¿æ¥ä¼ä¸šæœ¯è¯­åº“ï¼Œä¿æŒç¿»è¯‘ä¸€è‡´æ€§
4. **æ•°æ®é©±åŠ¨ç¿»è¯‘**ï¼šæŸ¥è¯¢æ•°æ®åº“è·å–äº§å“è§„æ ¼ã€ç”¨æˆ·ä¿¡æ¯ç­‰ï¼Œå‡†ç¡®ç¿»è¯‘æ•°æ®ç›¸å…³å†…å®¹

### ä¸¤å±‚ä¼˜å…ˆçº§æ¶æ„

æ’ä»¶é‡‡ç”¨ä¸¤å±‚ä¼˜å…ˆçº§ç­–ç•¥ç³»ç»Ÿï¼Œæä¾›ç²¾ç»†åŒ–çš„ MCP æ§åˆ¶ï¼š

```
ç¬¬1å±‚ï¼šMCPæœåŠ¡åŠŸèƒ½ï¼ˆæ€»å¼€å…³ï¼‰
    â””â”€ æ§åˆ¶æ‰€æœ‰MCPåŠŸèƒ½çš„å¯ç”¨/ç¦ç”¨
    â””â”€ ç¦ç”¨åï¼Œæ‰€æœ‰æç¤ºè¯ç­–ç•¥å’Œå‘½ä»¤ç³»ç»Ÿå‡ä¸å¯ç”¨

ç¬¬2å±‚ï¼šæç¤ºè¯çº§ç­–ç•¥ç»‘å®š
    â””â”€ ä¸ºæ¯ä¸ªæç¤ºè¯ç‹¬ç«‹è®¾ç½®MCPç­–ç•¥
    â””â”€ æ”¯æŒ5ç§ç­–ç•¥ï¼šç¦ç”¨æœåŠ¡/ç©ºç™½ç­–ç•¥/æ··åˆåˆ¤æ–­/å·¥å…·ä¼˜å…ˆ/å·¥å…·å¼ºåˆ¶
    â””â”€ æ–°æç¤ºè¯é»˜è®¤ä½¿ç”¨"ç¦ç”¨æœåŠ¡"ç­–ç•¥
```

**ä¼˜å…ˆçº§è§„åˆ™ï¼š**

- MCP æœåŠ¡åŠŸèƒ½å…³é—­æ—¶ï¼Œæ‰€æœ‰ç­–ç•¥ç»‘å®šå’Œå‘½ä»¤ç³»ç»Ÿå¤±æ•ˆ
- æç¤ºè¯ç‹¬ç«‹ç»‘å®šç­–ç•¥ï¼Œäº’ä¸å¹²æ‰°
- æ–°æç¤ºè¯é»˜è®¤ä½¿ç”¨"ç¦ç”¨æœåŠ¡"ç­–ç•¥ï¼ˆå¯é€šè¿‡å‘½ä»¤ç³»ç»Ÿæˆ–è®¾ç½®ç•Œé¢ä¿®æ”¹ï¼‰

### 5 ç§å·¥å…·è°ƒç”¨ç­–ç•¥

| ç­–ç•¥         | è¯´æ˜                               | é€‚ç”¨åœºæ™¯           |
| ------------ | ---------------------------------- | ------------------ |
| **ç¦ç”¨æœåŠ¡** | å®Œå…¨ç¦ç”¨ MCPï¼Œä½¿ç”¨æ ‡å‡† DeepSeek ç¿»è¯‘ | æ™®é€šæ–‡æœ¬ç¿»è¯‘       |
| **ç©ºç™½ç­–ç•¥** | ç«‹å³è¿æ¥ï¼ŒAI è‡ªè¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦å·¥å…·    | é€šç”¨ç¿»è¯‘ä»»åŠ¡       |
| **æ··åˆåˆ¤æ–­** | å¯é€‰ä½¿ç”¨å·¥å…·ï¼Œçµæ´»é€‚åº”ä¸åŒåœºæ™¯     | æ··åˆç±»å‹å†…å®¹       |
| **å·¥å…·ä¼˜å…ˆ** | ä¼˜å…ˆä½¿ç”¨å·¥å…·ï¼Œé€‚åˆä¸“ä¸šé¢†åŸŸ         | æŠ€æœ¯/å­¦æœ¯ç¿»è¯‘      |
| **å·¥å…·å¼ºåˆ¶** | å¼ºåˆ¶ä½¿ç”¨å·¥å…·ï¼Œç¡®ä¿å·¥å…·é“¾å‚ä¸       | é«˜è´¨é‡è¦æ±‚åœºæ™¯     |

### å‘½ä»¤ç³»ç»Ÿ

æ’ä»¶æ”¯æŒé€šè¿‡å‘½ä»¤å¿«é€Ÿåˆ‡æ¢ MCP ç­–ç•¥ï¼Œæ— éœ€æ‰“å¼€è®¾ç½®ç•Œé¢ï¼š

**è®¾ç½®ç•Œé¢å‘½ä»¤åˆ—è¡¨ï¼ˆè¡¨æ ¼å½¢å¼ï¼‰ï¼š**

åœ¨æ’ä»¶è®¾ç½®çš„â€œå‘½ä»¤åˆ—è¡¨â€å¡ç‰‡ä¸­ï¼Œä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤ï¼Œä¾¿äºæ–°æ‰‹å¿«é€ŸæŸ¥é˜…ï¼š

| ä¸­æ–‡å‘½ä»¤         | è‹±æ–‡å‘½ä»¤           | åŠŸèƒ½æè¿°                     |
| ---------------- | ------------------ | ---------------------------- |
| `/å½“å‰`          | `/now`             | æŸ¥çœ‹å½“å‰æç¤ºè¯çš„ç­–ç•¥å’Œå·¥å…·è®¾ç½®       |
| `/åˆ‡æ¢ [ç­–ç•¥]`   | `/switch [ç­–ç•¥]`   | åˆ‡æ¢å½“å‰æç¤ºè¯çš„ MCP ç­–ç•¥            |
| `/çŠ¶æ€`          | `/status`          | æŸ¥çœ‹ MCP æœåŠ¡çŠ¶æ€ã€æœåŠ¡å™¨åˆ—è¡¨å’Œç­–ç•¥  |
| `/å·¥å…·é“¾`        | `/chain`           | åˆ‡æ¢å½“å‰ç­–ç•¥çš„å·¥å…·é“¾æ˜¾ç¤ºå¼€å…³         |
| `/å·¥å…·ç»“æœ [æ¨¡å¼]`| `/result [æ¨¡å¼]`   | æŸ¥çœ‹/åˆ‡æ¢å½“å‰ç­–ç•¥çš„å·¥å…·ç»“æœæ˜¾ç¤ºæ¨¡å¼  |
| `/mcp`           | `/mcp`             | å¼€å¯æˆ–å…³é—­ MCP æœåŠ¡åŠŸèƒ½              |
| `/å¸®åŠ©`          | `/help`            | æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©ä¿¡æ¯                     |

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

| å‘½ä»¤                     | åŠŸèƒ½                           | ç¤ºä¾‹                         |
| ------------------------ | ------------------------------ | ---------------------------- |
| `/now` / `/å½“å‰`         | æŸ¥çœ‹å½“å‰æç¤ºè¯çš„ç­–ç•¥ã€å·¥å…·ç»“æœæ¨¡å¼å’Œå·¥å…·é“¾çŠ¶æ€ | `/å½“å‰`                      |
| `/switch [ç­–ç•¥]` / `/åˆ‡æ¢ [ç­–ç•¥]` | åˆ‡æ¢å½“å‰æç¤ºè¯çš„ MCP ç­–ç•¥      | `/åˆ‡æ¢ å·¥å…·å¼ºåˆ¶` æˆ– `/switch hybrid` |
| `/status` / `/çŠ¶æ€`      | æŸ¥çœ‹ MCP æœåŠ¡çŠ¶æ€ã€æœåŠ¡å™¨åˆ—è¡¨å’Œç­–ç•¥ | `/çŠ¶æ€`                      |
| `/chain` / `/å·¥å…·é“¾`     | åˆ‡æ¢å½“å‰ç­–ç•¥çš„å·¥å…·é“¾æ˜¾ç¤º       | `/å·¥å…·é“¾`                    |
| `/result [æ¨¡å¼]` / `/å·¥å…·ç»“æœ [æ¨¡å¼]` | åˆ‡æ¢å·¥å…·ç»“æœæ˜¾ç¤ºæ¨¡å¼ | `/å·¥å…·ç»“æœ æ··åˆ` æˆ– `/result mixed` |
| `/mcp`                   | å¼€å¯æˆ–å…³é—­ MCP æœåŠ¡åŠŸèƒ½        | `/mcp`                       |
| `/help` / `/å¸®åŠ©`        | æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©                   | `/å¸®åŠ©`                      |

**ä½¿ç”¨è§„åˆ™ï¼š**

- å‘½ä»¤ä»¥ `/` å¼€å¤´ï¼Œè§¦å‘å‘½ä»¤ç³»ç»Ÿ
- è¯­è¨€éœ€ä¸€è‡´ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰ï¼Œå¦‚ `/åˆ‡æ¢ å·¥å…·å¼ºåˆ¶` æˆ– `/switch hybrid`
- å‘½ä»¤ç³»ç»Ÿå— MCP æœåŠ¡åŠŸèƒ½å¼€å…³ç»Ÿè¾–ï¼ŒMCP ç¦ç”¨åå‘½ä»¤ç³»ç»Ÿä¸å¯ç”¨
- `/å·¥å…·é“¾`ã€`/å·¥å…·ç»“æœ`å‘½ä»¤éœ€è¦é€‰æ‹©æç¤ºè¯åæ‰å¯ç”Ÿæ•ˆ

**å·¥å…·ç»“æœæ˜¾ç¤ºæ¨¡å¼ï¼š**

| æ¨¡å¼   | è¯´æ˜                    |
| ------ | ----------------------- |
| `ç¦ç”¨` | ä¸æ˜¾ç¤ºå·¥å…·ç»“æœå’Œå†…è”æ ‡è®° |
| `ç²—ç•¥` | ä»…å†…è”æ˜¾ç¤ºå·¥å…·å        |
| `æ··åˆ` | å†…è”+æˆªæ–­æ˜¾ç¤ºç»“æœ       |
| `è¯¦ç»†` | å†…è”+å®Œæ•´æ˜¾ç¤ºç»“æœ       |

ğŸ‘‰ [æŸ¥çœ‹ MCP å·¥å…·è°ƒç”¨å®Œæ•´æ–‡æ¡£](./STranslate.Plugin.Translate.DeepSeek/docs/modules/mcp-tool-calling.md)  
ğŸ‘‰ [æŸ¥çœ‹ç­–ç•¥ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£](./STranslate.Plugin.Translate.DeepSeek/docs/modules/tool-strategy.md)  
ğŸ‘‰ [æŸ¥çœ‹å‘½ä»¤ç³»ç»Ÿæ–‡æ¡£](./STranslate.Plugin.Translate.DeepSeek/docs/modules/command-system.md)

## é¡¹ç›®ç»“æ„

```
STranslate.Plugin.Translate.DeepSeek/
â”‚
â”œâ”€â”€ Main.cs                          # æ ¸å¿ƒï¼šç¿»è¯‘é€»è¾‘ã€MCPç®¡ç†å’Œå‘½ä»¤ç³»ç»Ÿ
â”œâ”€â”€ Settings.cs                      # æ•°æ®æ¨¡å‹ï¼šé…ç½®å®šä¹‰
â”œâ”€â”€ McpClient.cs                     # MCPå®¢æˆ·ç«¯ï¼šè¿æ¥å’Œè°ƒç”¨
â”œâ”€â”€ McpServerConfig.cs               # MCPæœåŠ¡å™¨é…ç½®ç±»
â”œâ”€â”€ McpToolConfig.cs                 # MCPå·¥å…·é…ç½®ç±»
â”œâ”€â”€ StrategyEvents.cs                # å‘½ä»¤ç³»ç»Ÿä¸UIåŒæ­¥äº‹ä»¶
â”‚
â”œâ”€â”€ View/
â”‚   â””â”€â”€ SettingsView.xaml            # UIå¸ƒå±€ï¼šè®¾ç½®ç•Œé¢
â”‚
â”œâ”€â”€ ViewModel/
â”‚   â””â”€â”€ SettingsViewModel.cs         # è§†å›¾æ¨¡å‹ï¼šç•Œé¢é€»è¾‘
â”‚
â”œâ”€â”€ Converters/
â”‚   â””â”€â”€ StrategyConverters.cs        # æšä¸¾è½¬æ¢å™¨
â”‚
â”œâ”€â”€ Languages/                       # å¤šè¯­è¨€æ”¯æŒï¼ˆJSONæ ¼å¼ï¼‰
â”‚   â”œâ”€â”€ en.json                      # è‹±æ–‡åç§°å’Œæè¿°
â”‚   â”œâ”€â”€ zh-cn.json                   # ç®€ä½“ä¸­æ–‡åç§°å’Œæè¿°
â”‚   â””â”€â”€ zh-tw.json                   # ç¹ä½“ä¸­æ–‡åç§°å’Œæè¿°
â”‚
â”œâ”€â”€ docs/                            # è¯¦ç»†æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                    # æ–‡æ¡£å…¥å£
â”‚   â”œâ”€â”€ modules/                     # åŠŸèƒ½æ¨¡å—æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ project-structure.md     # é¡¹ç›®ç»“æ„
â”‚   â”‚   â”œâ”€â”€ main-logic.md           # ä¸»ç¿»è¯‘é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ settings-system.md      # è®¾ç½®ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ ui-layout.md            # UIå¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ mcp-client.md           # MCPå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ tool-strategy.md        # å·¥å…·ç­–ç•¥
â”‚   â”‚   â””â”€â”€ command-system.md       # å‘½ä»¤ç³»ç»Ÿ
â”‚   â”œâ”€â”€ guides/                      # å¼€å‘æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ build-deploy.md         # æ„å»ºéƒ¨ç½²
â”‚   â”‚   â””â”€â”€ troubleshooting.md      # æ•…éšœæ’é™¤
â”‚   â””â”€â”€ api/                         # APIå‚è€ƒ
â”‚       â””â”€â”€ interfaces.md           # æ¥å£å®šä¹‰
â”‚
â”œâ”€â”€ artifacts/                       # æ„å»ºè¾“å‡º
â”‚   â””â”€â”€ Debug/
â”‚       â””â”€â”€ STranslate.Plugin.DeepSeek.MCP.dll
â”‚
â””â”€â”€ plugin.json                      # æ’ä»¶å…ƒæ•°æ®
```

## å…³é”®æ–‡ä»¶è¯´æ˜

### Main.csï¼ˆæ ¸å¿ƒç¿»è¯‘å¼•æ“ï¼‰

- **èŒè´£**ï¼šå®ç° `ITranslator` æ¥å£ï¼Œå¤„ç†æ‰€æœ‰ç¿»è¯‘è¯·æ±‚
- **ä¸»è¦æ–¹æ³•**ï¼š
  - `TranslateAsync()` - ç¿»è¯‘å…¥å£ï¼Œè·¯ç”±åˆ° MCP æˆ–ä¼ ç»Ÿ API
  - `TranslateWithMcpTools()` - MCP ç¿»è¯‘æµç¨‹ï¼ˆå¤šè½®å·¥å…·è°ƒç”¨ï¼‰
  - `TranslateWithTraditionalApi()` - ä¼ ç»Ÿ DeepSeek API ç¿»è¯‘
  - `InitializeMcpAndGetSystemPrompt()` - åˆå§‹åŒ– MCP è¿æ¥
  - `GetSystemPromptByStrategy()` - æ ¹æ®ç­–ç•¥ç”Ÿæˆç³»ç»Ÿæç¤ºè¯
- **çŠ¶æ€ç®¡ç†**ï¼š`_mcpClients` - MCP å®¢æˆ·ç«¯åˆ—è¡¨
- **è¡Œæ•°**ï¼šçº¦ 900 è¡Œ

### Settings.csï¼ˆæ•°æ®æ¨¡å‹ï¼‰

- **èŒè´£**ï¼šå®šä¹‰æ‰€æœ‰é…ç½®æ•°æ®ç»“æ„
- **æ ¸å¿ƒç±»**ï¼š
  - `Settings` - ä¸»é…ç½®ï¼ˆAPI å¯†é’¥ã€MCP è®¾ç½®ç­‰ï¼‰
  - `McpServerConfig` - å•ä¸ªæœåŠ¡å™¨é…ç½®
  - `McpToolConfig` - å•ä¸ªå·¥å…·é…ç½®
  - `McpToolStrategy` - å·¥å…·ç­–ç•¥æšä¸¾ï¼ˆ5 ç§ç­–ç•¥ï¼‰

### McpClient.csï¼ˆMCP åè®®å®ç°ï¼‰

- **èŒè´£**ï¼šç®¡ç†å•ä¸ª MCP æœåŠ¡å™¨è¿æ¥
- **ä¸»è¦æ–¹æ³•**ï¼š
  - `ConnectAsync()` - è¿æ¥æœåŠ¡å™¨ï¼ˆJSON-RPC æ¡æ‰‹ï¼‰
  - `ListToolsAsync()` - è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
  - `CallToolAsync()` - è°ƒç”¨æŒ‡å®šå·¥å…·
- **åè®®**ï¼šMCP over HTTP (JSON-RPC 2.0)

### SettingsViewModel.csï¼ˆç•Œé¢é€»è¾‘ï¼‰

- **èŒè´£**ï¼šè®¾ç½®ç•Œé¢çš„æ•°æ®ç»‘å®šå’Œå‘½ä»¤å¤„ç†
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - æœåŠ¡å™¨ CRUD æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
  - å·¥å…·å‘ç°å’Œæµ‹è¯•è¿æ¥
  - è®¾ç½®è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ– 300msï¼‰
- **ä½¿ç”¨**ï¼š`CommunityToolkit.Mvvm` æºç”Ÿæˆå™¨

### SettingsView.xamlï¼ˆç”¨æˆ·ç•Œé¢ï¼‰

- **èŒè´£**ï¼šè®¾ç½®ç•Œé¢çš„å¸ƒå±€å’Œæ ·å¼
- **å¸ƒå±€ç»“æ„**ï¼š
  - API é…ç½®åŒºï¼ˆURLã€å¯†é’¥ã€æ¨¡å‹é€‰æ‹©ï¼‰
  - æç¤ºè¯é…ç½®åŒºï¼ˆæç¤ºè¯é€‰æ‹© + MCP ç­–ç•¥ç»‘å®š + ç¼–è¾‘ï¼‰
  - MCP æœåŠ¡åŠŸèƒ½å¡ç‰‡ï¼ˆå¯ç”¨/ç¦ç”¨å¼€å…³ + æ˜¾ç¤ºå·¥å…·é“¾å¼€å…³ï¼‰
  - MCP å…¨å±€è®¾ç½®åŒºï¼ˆå…¨å±€ç­–ç•¥ + æ—¥å¿—çº§åˆ«ï¼‰
  - MCP æœåŠ¡å™¨é…ç½®åŒºï¼ˆ7 è¡Œ Grid å¸ƒå±€ï¼‰
    - æœåŠ¡å™¨é…ç½®è¡Œï¼ˆä¸‹æ‹‰æ¡† + æŒ‰é’® + å¯ç”¨å¼€å…³ï¼‰
    - åˆ é™¤ç¡®è®¤æç¤º
    - æœåŠ¡å™¨åç§°è¾“å…¥
    - æœåŠ¡å™¨åœ°å€è¾“å…¥
    - è¯·æ±‚ä½“è¾“å…¥ï¼ˆAPI å¯†é’¥ï¼‰
    - å·¥å…·åˆ—è¡¨ä¸‹æ‹‰ï¼ˆå¸¦å¯ç”¨å¼€å…³ï¼‰
    - æµ‹è¯•è¿æ¥æŒ‰é’® + ç»“æœ
- **å¸ƒå±€åŸåˆ™**ï¼šæ ‡ç­¾å³å¯¹é½ï¼ˆ70px/110px åˆ—å®½ï¼‰ï¼Œè¾“å…¥æ¡†å·¦å¯¹é½æ‹‰ä¼¸

## æ ¸å¿ƒå·¥ä½œæµç¨‹

### 1. ç¿»è¯‘æµç¨‹

```
ç”¨æˆ·è¾“å…¥æ–‡æœ¬
    â†“
æ£€æŸ¥æ˜¯å¦ä»¥"/"å¼€å¤´ä¸”å‘½ä»¤ç³»ç»Ÿå·²å¯ç”¨
    â†“
    â”œâ”€ æ˜¯ â†’ è§£æå¹¶æ‰§è¡Œå‘½ä»¤ â†’ è¿”å›å‘½ä»¤ç»“æœ
    â””â”€ å¦ â†’ ç»§ç»­ç¿»è¯‘æµç¨‹
              â†“
          TranslateAsync()
              â†“
          æ£€æŸ¥MCPæ˜¯å¦å¯ç”¨
              â†“
              â”œâ”€ ç¦ç”¨ â†’ TranslateWithTraditionalApi() â†’ DeepSeek API
              â””â”€ å¯ç”¨ â†’ TranslateWithMcpTools()
                          â†“
                      åˆå§‹åŒ–MCPï¼ˆè¿æ¥æœåŠ¡å™¨ã€è·å–å·¥å…·ï¼‰
                          â†“
                      æ„å»ºç³»ç»Ÿæç¤ºè¯ï¼ˆæ ¹æ®æç¤ºè¯ç»‘å®šç­–ç•¥ï¼‰
                          â†“
                      å‘é€è¯·æ±‚åˆ°DeepSeekï¼ˆéæµå¼ï¼‰
                          â†“
                      AIåˆ¤æ–­æ˜¯å¦è°ƒç”¨å·¥å…·
                          â†“
                      â”œâ”€ ç›´æ¥å›ç­” â†’ è¿”å›ç»“æœ
                      â””â”€ è°ƒç”¨å·¥å…· â†’ æ‰§è¡Œå·¥å…· â†’ åŠ å…¥ä¸Šä¸‹æ–‡ â†’ å†æ¬¡è¯·æ±‚ï¼ˆå¾ªç¯ï¼‰
```

### 2. ç­–ç•¥ç³»ç»Ÿ

| ç­–ç•¥         | è¿æ¥æ—¶æœº   | å·¥å…·ä½¿ç”¨     | ç³»ç»Ÿæç¤ºè¯ç‰¹ç‚¹                 |
| ------------ | ---------- | ------------ | ------------------------------ |
| **Disabled** | ä¸è¿æ¥     | ä¸ä½¿ç”¨       | æ—                              |
| **Blank**    | ç«‹å³è¿æ¥   | AI è‡ªè¡Œåˆ¤æ–­  | åªåˆ—å‡ºå·¥å…·                     |
| **Hybrid**   | ç«‹å³è¿æ¥   | å¯é€‰ä½¿ç”¨     | "Tools are OPTIONAL"           |
| **ToolFirst**| ç«‹å³è¿æ¥   | ä¼˜å…ˆä½¿ç”¨     | "PRIORITIZE using tools"       |
| **ToolForced**| ç«‹å³è¿æ¥  | å¿…é¡»ä½¿ç”¨     | "MUST use tools"               |

### 3. å‘½ä»¤ç³»ç»Ÿæµç¨‹

```
ç”¨æˆ·è¾“å…¥å‘½ä»¤ï¼ˆå¦‚"/åˆ‡æ¢ å·¥å…·å¼ºåˆ¶"ï¼‰
    â†“
ExecuteCommandAsync()
    â†“
è§£æå‘½ä»¤å’Œå‚æ•°
    â†“
éªŒè¯å½“å‰æç¤ºè¯æ˜¯å¦å­˜åœ¨
    â†“
æ›´æ–° PromptStrategyMap
    â†“
è§¦å‘ StrategyEventsï¼ˆé€šçŸ¥UIæ›´æ–°ï¼‰
    â†“
è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ
```

### 4. è®¾ç½®æŒä¹…åŒ–

```
ç”¨æˆ·ä¿®æ”¹è®¾ç½® â†’ ViewModelå±æ€§å˜æ›´
    â†“
OnPropertyChanged() â†’ é˜²æŠ–å®šæ—¶å™¨(300ms)
    â†“
SaveSettings() â†’ Context.SaveSettings()
    â†“
ä¿å­˜åˆ° STranslate\current\PortableConfig\Settings\Plugins\STranslate.Plugin.DeepSeek.MCP_d99c702e39b44be5a9e49983ff0f4fff
```

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚

- **.NET SDK 8.0** æˆ–æ›´é«˜
- **Visual Studio 2022** / VS Code / Rider
- **Windows 10/11**

### æ„å»ºé¡¹ç›®

```bash
# è¿˜åŸä¾èµ–
dotnet restore

# æ„å»ºDebugç‰ˆæœ¬ï¼ˆå¼€å‘è°ƒè¯•ï¼‰
dotnet build --configuration Debug

# æ„å»ºReleaseç‰ˆæœ¬ï¼ˆæ­£å¼å‘å¸ƒï¼‰
dotnet build --configuration Release
```

### å¿«æ·å®‰è£…

è·å– `.spkg` æ–‡ä»¶ã€‚  
æ‰“å¼€ STranslate è½¯ä»¶ï¼Œè¿›å…¥ **è®¾ç½® > æ’ä»¶**ã€‚  
å°†ä¸‹è½½çš„æ–‡ä»¶æ‹–å…¥çª—å£å³å¯å®‰è£…ã€‚

### å¼€å‘è§„èŒƒ

1. **ä¿®æ”¹ç¿»è¯‘é€»è¾‘** â†’ ç¼–è¾‘ `Main.cs`
2. **ä¿®æ”¹è®¾ç½®ç•Œé¢** â†’ ç¼–è¾‘ `SettingsView.xaml` å’Œ `SettingsViewModel.cs`
3. **æ·»åŠ é…ç½®é¡¹** â†’ ç¼–è¾‘ `Settings.cs` â†’ ViewModel â†’ XAML
4. **ä¿®æ”¹ MCP åŠŸèƒ½** â†’ ç¼–è¾‘ `McpClient.cs`

## å¸¸è§ä¿®æ”¹åœºæ™¯

### åœºæ™¯1ï¼šæ·»åŠ æ–°çš„ç¿»è¯‘ç­–ç•¥

1. åœ¨ `Settings.cs` çš„ `McpToolStrategy` æšä¸¾æ·»åŠ æ–°å€¼
2. åœ¨ `Main.cs` çš„ `GetSystemPromptByStrategy()` æ·»åŠ æç¤ºè¯
3. åœ¨ `Converters/StrategyConverters.cs` æ·»åŠ åç§°å’Œæè¿°
4. åœ¨ `SettingsView.xaml` æ›´æ–°ç­–ç•¥ä¸‹æ‹‰æ¡†ç»‘å®š
5. åœ¨ `Main.cs` çš„ `ExecuteCommandAsync()` æ·»åŠ ç­–ç•¥åç§°æ˜ å°„

### åœºæ™¯2ï¼šä¿®æ”¹å·¥å…·é“¾æ˜¾ç¤ºæ ¼å¼

1. æ‰¾åˆ° `Main.cs` ä¸­çš„ `FormatToolChainItem()` æ–¹æ³•
2. ä¿®æ”¹è¿”å›æ ¼å¼ï¼ˆå½“å‰ï¼š`toolNameâœ…` / `toolNameâŒ`ï¼‰
3. ä¿®æ”¹ `TranslateWithMcpTools()` ä¸­çš„æ˜¾ç¤ºé€»è¾‘

### åœºæ™¯3ï¼šè°ƒæ•´ UI å¸ƒå±€

1. æ‰“å¼€ `View/SettingsView.xaml`
2. ä¿®æ”¹ Grid çš„ ColumnDefinition å®½åº¦ï¼ˆæ ‡ç­¾åˆ—é»˜è®¤ 110pxï¼‰
3. è°ƒæ•´ Margin å€¼ï¼ˆæ ‡ç­¾å³è¾¹è·é»˜è®¤ 20pxï¼‰
4. ç¡®ä¿æ‰€æœ‰è¡Œçš„åˆ—å®šä¹‰ä¿æŒä¸€è‡´

### åœºæ™¯4ï¼šæ·»åŠ æ–°çš„ MCP åŠŸèƒ½

1. åœ¨ `McpClient.cs` æ·»åŠ æ–°æ–¹æ³•ï¼ˆå¦‚ `GetResourceAsync()`ï¼‰
2. åœ¨ `Main.cs` çš„ç¿»è¯‘æµç¨‹ä¸­è°ƒç”¨æ–°æ–¹æ³•
3. æ·»åŠ ç›¸åº”çš„é…ç½®é¡¹ï¼ˆå¦‚æœéœ€è¦ï¼‰

## è°ƒè¯•æŠ€å·§

### å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨è®¾ç½®ç•Œé¢é€‰æ‹©â€œæ—¥å¿—çº§åˆ«ï¼šè¯¦ç»†â€ï¼Œå°†è¾“å‡ºï¼š

- MCP è¿æ¥çŠ¶æ€
- å·¥å…·è°ƒç”¨è¯¦æƒ…
- API è¯·æ±‚/å“åº”

### æŸ¥çœ‹æ—¥å¿—ä½ç½®

```
STranslate\current\PortableConfig\Logs
```

### å¸¸è§è°ƒè¯•æ–­ç‚¹

- `Main.cs:TranslateAsync()` - ç¿»è¯‘å…¥å£
- `Main.cs:InitializeMcpAndGetSystemPrompt()` - MCP åˆå§‹åŒ–
- `SettingsViewModel.cs:SaveSettings()` - è®¾ç½®ä¿å­˜
- `McpClient.cs:ConnectAsync()` - MCP è¿æ¥

## ç›¸å…³èµ„æº

- **STranslate ä¸»é¡¹ç›®**ï¼š<https://github.com/ZGGSONG/STranslate>
- æœ¬é¡¹ç›®åŸºäº [STranslate.Plugin.Translate.DeepSeek](https://github.com/monbed/STranslate.Plugin.Translate.DeepSeek) ä¿®æ”¹è€Œæ¥ï¼Œéµå¾ª MIT è®¸å¯è¯ã€‚
- **DeepSeek API æ–‡æ¡£**ï¼š<https://platform.deepseek.com/>
- **MCP åè®®è§„èŒƒ**ï¼š<https://modelcontextprotocol.io/>
- **é¡¹ç›®è¯¦ç»†æ–‡æ¡£**ï¼šè§ `docs/` ç›®å½•

## é—®é¢˜åé¦ˆ

é‡åˆ°é—®é¢˜è¯·ï¼š

1. æŸ¥çœ‹ `docs/guides/troubleshooting.md` æ•…éšœæ’é™¤æŒ‡å—
2. æ£€æŸ¥ `STranslate\current\PortableConfig\Logs` ä¸­çš„æ—¥å¿—
3. æäº¤ Issue æ—¶æä¾›ï¼ˆå› ä½œè€…ä½¿ç”¨ AI åˆ¶ä½œæœ¬æ’ä»¶é¡¹ç›®ï¼Œæ•…ä¸ä¿è¯åŠæ—¶å¤„ç†é—®é¢˜ï¼‰ï¼š
   - ç¯å¢ƒä¿¡æ¯ï¼ˆWindows/.NET ç‰ˆæœ¬ï¼‰
   - å¤ç°æ­¥éª¤
   - ç›¸å…³æ—¥å¿—ç‰‡æ®µ
   - é…ç½®æ–‡ä»¶ï¼ˆåˆ é™¤æ•æ„Ÿä¿¡æ¯ï¼‰

---

**æ³¨æ„**ï¼šæœ¬æ–‡æ¡£æ˜¯ AI å‹å¥½çš„é¡¹ç›®æ¦‚è¿°ã€‚è¯¦ç»†çš„å®ç°ç»†èŠ‚å’Œä¿®æ”¹æŒ‡å—è¯·æŸ¥çœ‹ `docs/` ç›®å½•ä¸‹çš„å®Œæ•´æ–‡æ¡£ã€‚

*æœ€åæ›´æ–°ï¼š2025å¹´2æœˆ*
